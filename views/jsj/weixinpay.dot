<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>微信支付</title>
<meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no" name="viewport"  />
<meta name = "format-detection" content = "telephone=no">
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js" async ></script>
<script src="http://lib.sinaapp.com/js/jquery/1.9.1/jquery-1.9.1.min.js"></script>
</head>
    <body>
    <script>
        /**
         * 从后台获取微信支付验证参数
         */

        //var payordernumber="js154546545",totalfee=0.01,openid="obsLEuFmAHp5eNcLNoACrzkrJ5CI";
        var query=location.search;
        var url="/jsj/user/wechat/payconfig"+query;
        $(function () {
            $.get(url,function (obj) {
                console.log("微信支付验证参数：",obj);
                if(obj.code == 0){
                    wx.config({
                        debug: true, // 开启调试模式,打出，仅在pc端时才会打印。
                        appId: obj.record.appid, // 必填，公众号的唯一标识
                        timestamp: obj.record.timestamp, // 必填，生成签名的时间戳
                        nonceStr:  obj.record.noncstr, // 必填，生成签名的随机串
                        signature: obj.record.paymentpackage,// 必填，签名，见附录1
                        jsApiList: ["chooseWXPay"] // 必填
                    });
                    wx.ready(()=>{
                        alert("ready");
                        wx.chooseWXPay({
                            timestamp: obj.record.timestamp,
                            nonceStr: obj.record.noncstr,
                            package: "prepay_id="+obj.record.prepayid,
                            signType: "MD5",
                            paySign: obj.record.sign,
                            success: function (res) {
                                alert("success");
                                console.log("支付成功:",res);
                            }
                        });
                    });
                    wx.error(function(res){
                        console.log("微信验证错误：",res);
                    });
                }else {

                }
            },"json");
        });

    </script>
    </body>
</html>